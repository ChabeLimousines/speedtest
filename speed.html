<html>
<head>
<script type="application/javascript" src="./jquery.js" ></script>
<script type="application/javascript">

//var target_size = 1;
var lock = false;

$(document).ready(function() {
	//$("body").text("test");
	//var tests = [];
	runtests(1, null);
	/*testspeed(50*2, function(r) {
		$('#result').append("<p>"+50*2 +"MB in "+r.Diff+" milliseconds<br />" + r.Start + "<br />" + r.End +"</p>");
	});*/
});
	
function runtests(target_size, last_test) {
	if(target_size > 50 || (last_test != null && last_test.Diff > 30000)) {
		//end;
		$('#result').append("<p>End</p>");
		return;
	}
	
	var start = new Date();
	$.get('/download?size=' + target_size, function() {
		var end = new Date();
		//cb({"Start": start, "End": end, "Diff": end.getTime() - start.getTime()});
		var r = {"Start": start, "End": end, "Diff": end.getTime() - start.getTime()};
		$('#result').append("<p>"+target_size +"MB in "+r.Diff+" milliseconds<br />" + r.Start + "<br />" + r.End +"</p>");
		runtests(Math.ceil(target_size*1.5), r);
	});
}
function testspeed(size, cb) {
	var start = new Date();
	$.get('/download?size=' + size, function() {
		var end = new Date();
		cb({"Start": start, "End": end, "Diff": end.getTime() - start.getTime()});
	});
}
</script>
</head>
<body>
	
	<div id="result"></div>
</body>
</html>